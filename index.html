<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kelime UygulamasÄ± - v37 (60 Seviye - Fix)</title>
    <style>
        /* --- TEMEL AYARLAR --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background-color: #2c3e50; 
            color: white; 
            width: 100%;
            height: 100vh; 
            height: 100dvh;
            overflow: hidden; 
        }

        .app-container { 
            width: 100%; max-width: 600px; 
            margin: 0 auto; 
            background-color: #4a6a7a; 
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .fixed-header-group {
            flex-shrink: 0;
            background-color: #354f5c;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        header.home-header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px 20px; 
            height: 60px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .app-title { font-size: 18px; font-weight: bold; }
        .profile-pic { width: 36px; height: 36px; background-color: #f3d290; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-size: 20px; color: #333; }
        
        .tabs { 
            display: flex; overflow-x: auto; 
            white-space: nowrap; 
            padding: 0; 
            height: 50px; 
            align-items: center;
            scrollbar-width: none;
        }
        .tabs::-webkit-scrollbar { display: none; }
        
        .tab { 
            padding: 0 15px; height: 100%;
            display: flex; align-items: center;
            color: #bdc3c7; 
            font-weight: bold; font-size: 14px; 
            position: relative; cursor: pointer;
            flex-shrink: 0; transition: color 0.3s;
        }
        .tab.active { color: #f1c40f; background-color: rgba(255,255,255,0.05); }
        .tab.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%;
            height: 4px; background-color: #f1c40f; }

        .content-area { 
            flex-grow: 1; overflow-y: auto; 
            padding: 15px;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch;
        }

        .level-card { 
            background-color: #3e5c6a; border: 2px solid #d4a35a; 
            border-radius: 12px; 
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px; margin-bottom: 15px; 
            cursor: pointer; 
            position: relative; transition: transform 0.1s;
        }
        .level-card:active { transform: scale(0.98); background-color: #354f5c; }
        
        .level-card.completed {
            background-color: #27ae60; border-color: #2ecc71;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        }

        .level-icon { font-size: 24px; margin-right: 15px; }
        .level-info { font-size: 16px; font-weight: bold; }
        .level-progress { color: #ecf0f1; font-size: 13px; opacity: 0.8; }
        .mastery-badge { 
            font-size: 11px; background-color: rgba(0,0,0,0.3); 
            padding: 3px 8px; border-radius: 10px; margin-top: 4px; display: inline-block;
        }

        /* --- KELÄ°ME LÄ°STESÄ° EKRANI --- */
        #list-screen {
            display: none; flex-direction: column;
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #2c3e50;
            z-index: 5000;
        }
        .list-header {
            padding: 15px; display: flex; align-items: center; justify-content: space-between;
            background-color: #354f5c; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .back-btn { font-size: 28px; cursor: pointer; background:none; border:none; color:white; padding: 5px 15px; }
        
        .list-content {
            flex-grow: 1; overflow-y: auto; padding: 15px;
            padding-bottom: 100px;
        }
        .word-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 18px 15px; margin-bottom: 10px;
            background-color: rgba(255,255,255,0.08);
            border-radius: 8px; border-left: 4px solid #f1c40f;
        }
        .word-eng { font-weight: bold; font-size: 17px; color: #fff; display:flex; align-items:center; gap:8px; }
        .word-tr { color: #bdc3c7; font-size: 15px; font-style: italic; }
        
        .fixed-bottom-btn-container {
            position: absolute; bottom: 0; left: 0; right: 0;
            padding: 20px; background: linear-gradient(to top, #2c3e50 80%, transparent);
        }
        .start-quiz-btn {
            width: 100%; padding: 16px; background-color: #27ae60; color: white;
            border: none; border-radius: 12px; font-size: 18px; font-weight: bold;
        }

        /* --- TEST EKRANI --- */
        #quiz-screen { 
            display: none; flex-direction: column; 
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #1a1a1a; z-index: 9999; padding: 20px;
        }
        .quiz-header { display: flex; justify-content: space-between; align-items: center; height: 50px; }
        .close-btn { font-size: 32px; color: #e74c3c; cursor: pointer; }
        .progress-track { flex-grow: 1; height: 8px; background-color: #333; border-radius: 4px; overflow: hidden; margin: 0 15px; }
        #progress-fill { width: 0%; height: 100%; background-color: #3498db; transition: width 0.3s; }
        
        .quiz-content { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .word-to-solve { font-size: 32px; font-weight: 800; margin-bottom: 40px; text-align: center; }
        .options { width: 100%; display: flex; flex-direction: column; gap: 12px; }
        .option-btn { background-color: #333; border: none; color: #ecf0f1; padding: 18px; border-radius: 12px; font-size: 16px; font-weight: 600; }
        .option-btn.correct { background-color: #27ae60; }
        .option-btn.wrong { background-color: #e74c3c; }

        /* SONUÃ‡ EKRANI */
        #result-screen { display: none; flex-direction: column; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: #1a1a1a; z-index: 10000; }
        .result-card { background-color: #3e5c6a; width: 85%; padding: 30px; border-radius: 20px; text-align: center; border: 2px solid #d4a35a; }
        .score-circle { width: 100px; height: 100px; border-radius: 50%; background: #f1c40f; color: #1a1a1a; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; }
        .home-btn { background-color: #f1c40f; color: #1a1a1a; border: none; padding: 15px 40px; border-radius: 30px; font-size: 18px; font-weight: bold; margin-top: 20px; }
        
        .form-select, .form-textarea { width: 100%; padding: 12px; background-color: #2c3e50; border: 1px solid #546e7a; border-radius: 10px; color: white; margin-bottom: 10px; }
        .save-btn { width: 100%; padding: 14px; background-color: #f1c40f; border: none; border-radius: 10px; font-weight: bold; }
        
        #success-overlay { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; background-color: #27ae60; border-radius: 20px; justify-content: center; align-items: center; z-index: 10001; }
        .checkmark { width: 25px; height: 50px; border-bottom: 8px solid white; border-right: 8px solid white; transform: rotate(45deg); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="fixed-header-group">
        <header class="home-header">
            <div style="font-size:24px;">ðŸ“–</div>
            <div class="app-title" id="app-header-title">YDS KELÄ°ME</div>
            <div class="profile-pic">ðŸ‘¤</div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('YDS', this)">YDS</div>
            <div class="tab" onclick="switchTab('H', this)">HABER</div>
            <div class="tab" onclick="switchTab('B2', this)">B2</div>
            <div class="tab" onclick="switchTab('B1', this)">B1</div>
            <div class="tab" onclick="switchTab('C', this)">C</div>
            <div class="tab" onclick="switchTab('DICT', this)">SÃ–ZLÃœK</div>
            <div class="tab" onclick="switchTab('ADD', this)">âž• EKLE</div>
        </div>
    </div>

    <div class="content-area" id="content-container"></div>

    <div id="list-screen">
        <header class="list-header">
            <button class="back-btn" onclick="closeListScreen()">â¬…</button>
            <div style="font-weight:bold; font-size:18px;" id="list-title">Seviye 1</div>
            <div style="width:45px;"></div>
        </header>
        <div class="list-content" id="list-content-area"></div>
        <div class="fixed-bottom-btn-container">
            <button class="start-quiz-btn" id="btn-start-quiz-from-list">TESTE BAÅžLA</button>
        </div>
    </div>

    <div id="quiz-screen">
        <header class="quiz-header">
            <div class="close-btn" onclick="quitQuiz()">âœ•</div>
            <div class="progress-track"><div id="progress-fill"></div></div>
            <div style="color:#3498db; font-weight:bold; min-width: 40px;" id="progress-text">1/20</div>
        </header>
        <div class="quiz-content">
            <div style="font-size:40px; margin-bottom:20px; cursor:pointer;" onclick="speakCurrentWord()">ðŸ”Š</div>
            <div class="word-to-solve" id="target-word">...</div>
            <div class="options" id="options-container"></div>
        </div>
        <div id="success-overlay"><div class="checkmark"></div></div>
    </div>

    <div id="result-screen">
        <div class="result-card">
            <h2>Tebrikler!</h2>
            <div class="score-circle" id="final-score">0/0</div>
            <div id="mastery-msg" style="color:#f1c40f; margin:10px 0; display:none;">YENÄ° SEVÄ°YE AÃ‡ILDI!</div>
            <button class="home-btn" onclick="closeResultScreen()">ANA SAYFA</button>
        </div>
    </div>
</div>

<script>
    let vocabularyData = {};
    const DB_KEY = 'VocabApp_FixedList_v37'; // SÃ¼rÃ¼m v37 - Temiz kurulum saÄŸlar

    const sample = [
        {"en":"Abandon","tr":"Terk etmek"},{"en":"Abruptly","tr":"Aniden"},{"en":"Abundance","tr":"Bolluk"},{"en":"Accelerate","tr":"HÄ±zlandÄ±rmak"},{"en":"Accommodate","tr":"BarÄ±ndÄ±rmak"},{"en":"Accurately","tr":"DoÄŸru ÅŸekilde"},{"en":"Acknowledge","tr":"Kabul etmek"},{"en":"Adapt","tr":"Uyarlamak"},{"en":"Adequate","tr":"Yeterli"},{"en":"Adhere","tr":"BaÄŸlÄ± kalmak"}
    ];

    function initApp() {
        const stored = localStorage.getItem(DB_KEY);
        if(stored) {
            vocabularyData = JSON.parse(stored);
        } else {
            // Ä°lk kurulum: 60 Seviyeli YDS yapÄ±sÄ±
            vocabularyData = { "progress": { "YDS":{}, "H":{}, "B2":{}, "B1":{}, "C":{} }, "YDS": {}, "H": {}, "B2": {}, "B1": {}, "C": {} };
            for(let i=1; i<=60; i++) vocabularyData["YDS"][i] = [...sample];
            for(let cat of ["H","B2","B1"]) { for(let i=1; i<=30; i++) vocabularyData[cat][i] = [...sample]; }
            for(let i=1; i<=20; i++) vocabularyData["C"][i] = [...sample];
            saveToMemory();
        }
    }

    function saveToMemory() { localStorage.setItem(DB_KEY, JSON.stringify(vocabularyData)); }

    let activeCategory = 'YDS';
    let activeLevelId = 1;
    let currentQuestions = [];
    let currentStep = 0;
    let correctCount = 0;

    window.onload = () => { initApp(); switchTab('YDS', document.querySelector('.tab')); };

    function switchTab(cat, el) {
        activeCategory = cat;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        if(el) el.classList.add('active');
        
        const container = document.getElementById('content-container');
        container.innerHTML = "";

        if(cat === 'ADD') {
            renderAddScreen();
        } else if(cat === 'DICT') {
            renderDictionary();
        } else {
            let max = cat === 'YDS' ? 60 : (cat === 'C' ? 20 : 30);
            const icons = ["ðŸ“•","ðŸ“—","ðŸ“˜","ðŸ“™","ðŸ““","ðŸ“’"];
            for(let i=1; i<=max; i++) {
                let isDone = (vocabularyData.progress[cat][i] || 0) >= 2;
                container.innerHTML += `
                    <div class="level-card ${isDone ? 'completed' : ''}" onclick="openWordList(${i})">
                        <div style="display:flex; align-items:center;">
                            <span class="level-icon">${icons[i%6]}</span>
                            <span class="level-info">${i}. Seviye</span>
                        </div>
                        <div style="text-align:right">
                            <div class="level-progress">10 Kelime</div>
                            ${isDone ? '<div class="mastery-badge">âœ“ TamamlandÄ±</div>' : ''}
                        </div>
                    </div>`;
            }
        }
    }

    function openWordList(lvl) {
        activeLevelId = lvl;
        const words = vocabularyData[activeCategory][lvl] || [];
        document.getElementById('list-title').innerText = activeCategory + " - Seviye " + lvl;
        const area = document.getElementById('list-content-area');
        area.innerHTML = words.map(w => `
            <div class="word-row">
                <div class="word-eng"><span>ðŸ”Š</span> ${w.en}</div>
                <div class="word-tr">${w.tr}</div>
            </div>`).join('');
        
        document.getElementById('btn-start-quiz-from-list').onclick = () => startQuiz(words);
        document.getElementById('list-screen').style.display = 'flex';
    }

    function closeListScreen() { 
        document.getElementById('list-screen').style.display = 'none'; 
    }

    function startQuiz(words) {
        currentQuestions = words.map(w => {
            let opts = [w.tr];
            while(opts.length < 4) {
                let r = words[Math.floor(Math.random()*words.length)].tr;
                if(!opts.includes(r)) opts.push(r);
            }
            return { en: w.en, correct: w.tr, options: opts.sort(() => Math.random()-0.5) };
        });
        currentStep = 0; correctCount = 0;
        document.getElementById('list-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'flex';
        renderQuestion();
    }

    function renderQuestion() {
        if(currentStep >= currentQuestions.length) { finishQuiz(); return; }
        let q = currentQuestions[currentStep];
        document.getElementById('target-word').innerText = q.en;
        document.getElementById('progress-text').innerText = (currentStep+1) + "/" + currentQuestions.length;
        document.getElementById('progress-fill').style.width = ((currentStep+1)/currentQuestions.length)*100 + "%";
        
        document.getElementById('options-container').innerHTML = q.options.map(opt => `
            <button class="option-btn" onclick="checkAnswer(this, '${opt}', '${q.correct}')">${opt}</button>
        `).join('');
    }

    function checkAnswer(btn, sel, cor) {
        if(sel === cor) {
            btn.classList.add('correct'); correctCount++;
            document.getElementById('success-overlay').style.display = 'flex';
            setTimeout(() => { document.getElementById('success-overlay').style.display = 'none'; nextQ(); }, 600);
        } else {
            btn.classList.add('wrong');
            setTimeout(nextQ, 1000);
        }
    }

    function nextQ() { currentStep++; renderQuestion(); }

    function finishQuiz() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'flex';
        document.getElementById('final-score').innerText = correctCount + "/" + currentQuestions.length;
        
        if(correctCount === currentQuestions.length) {
            let p = vocabularyData.progress[activeCategory][activeLevelId] || 0;
            vocabularyData.progress[activeCategory][activeLevelId] = p + 1;
            saveToMemory();
            document.getElementById('mastery-msg').style.display = 'block';
        }
    }

    function closeResultScreen() {
        document.getElementById('result-screen').style.display = 'none';
        switchTab(activeCategory, null);
    }

    function quitQuiz() { if(confirm("Ã‡Ä±kÄ±lsÄ±n mÄ±?")) document.getElementById('quiz-screen').style.display = 'none'; }
    
    function renderAddScreen() {
        document.getElementById('content-container').innerHTML = `
            <div style="background:#3e5c6a; padding:20px; border-radius:15px;">
                <h3>Kelime Ekle</h3>
                <select id="add-lvl" class="form-select">
                    ${Array.from({length:60}, (_,i)=>`<option value="${i+1}">${i+1}. Seviye</option>`).join('')}
                </select>
                <textarea id="add-txt" class="form-textarea" rows="5" placeholder="Word : AnlamÄ±"></textarea>
                <button class="save-btn" onclick="processAdd()">KAYDET</button>
            </div>`;
    }

    function processAdd() {
        let lvl = document.getElementById('add-lvl').value;
        let txt = document.getElementById('add-txt').value;
        if(!txt) return;
        txt.split('\n').forEach(line => {
            let p = line.split(':');
            if(p.length===2) vocabularyData[activeCategory][lvl].push({en:p[0].trim(), tr:p[1].trim()});
        });
        saveToMemory(); alert("Eklendi!");
    }

    function renderDictionary() {
        document.getElementById('content-container').innerHTML = `
            <input type="text" placeholder="Ara..." style="width:100%; padding:15px; border-radius:25px; border:none;" onkeyup="dictSearch(this.value)">
            <div id="dict-results" style="margin-top:20px;"></div>`;
    }

    function dictSearch(val) {
        if(val.length < 2) return;
        let res = "";
        for(let lvl in vocabularyData[activeCategory]) {
            vocabularyData[activeCategory][lvl].forEach(w => {
                if(w.en.toLowerCase().includes(val.toLowerCase()))
                    res += `<div style="padding:10px; border-bottom:1px solid #546e7a">${w.en} : ${w.tr}</div>`;
            });
        }
        document.getElementById('dict-results').innerHTML = res;
    }

    function speakCurrentWord() {
        let msg = new SpeechSynthesisUtterance(document.getElementById('target-word').innerText);
        msg.lang = 'en-US'; window.speechSynthesis.speak(msg);
    }
</script>
</body>
</html>
